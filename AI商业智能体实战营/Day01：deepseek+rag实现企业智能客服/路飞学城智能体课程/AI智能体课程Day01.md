# AI智能体课程Day01



```apl
# 课程介绍
  # 智能体（10） -yuan
    # 智能体案例
    # coze平台
    
    # 编程（配套Python基础）
    # 爬虫+AI Agent

# LLM开发

# LLM框架

# 学习方法
1  复盘（敲代码）
2  记笔记
3  坚持、坚持、坚持

# 答疑老师
```

## 实战案例1：Deepseek+RAG打造企业智能客服

* 知识库是一个系统化的信息存储库，包含各种知识、规则和数据，旨在支持智能体的决策和推理过程。它可以是结构化的（如数据库）或非结构化的（如文档和文本）。
* 智能体是能够自主感知环境、进行推理和决策，并采取行动以实现特定目标的系统。智能体通常依赖于知识库来获取必要的信息和理解复杂的场景。

RAG（Retrieval-Augmented Generation）是一种结合了信息检索和自然语言生成的技术，旨在提高生成模型的性能和准确性。具体来说，RAG 的工作方式如下：

1. 结构

RAG 模型通常由两个主要组件组成：

- **检索器（Retriever）**：负责从一个外部知识库或数据库中检索相关文档或信息。这些信息可以是结构化的数据、文本文件或其他形式的知识。
- **生成器（Generator）**：基于检索到的信息生成自然语言响应或文本。这一部分通常使用类似于 GPT 或 BERT 的语言模型。

2. 工作流程

- **输入处理**：用户输入一个查询或问题。
- **检索阶段**：检索器根据输入查询从知识库中找出相关的信息。
- **生成阶段**：生成器使用这些检索到的信息来生成最终的回答。生成的文本通常会更具上下文相关性和准确性，因为它是基于最新的、相关的知识构建的。

3. 优势

- **知识丰富性**：通过检索外部信息，RAG 模型能够访问更广泛的知识，不仅限于训练数据。
- **提高准确性**：生成的答案通常更符合实际情况，因为它们基于实时信息。
- **灵活性**：可以适应不同领域和主题的查询，增强了模型的应用范围。

RAG 模型广泛应用于聊天机器人、智能助理、问答系统和其他需要实时信息的自然语言处理任务。底层原理如图：

![截屏2025-03-20 下午3.13.00](./assets/%E6%88%AA%E5%B1%8F2025-03-20%20%E4%B8%8B%E5%8D%883.13.00-2454818-2454819.png)

搭建智能体后我们选择==对话流模式==

![image-20250320下午43231319](./assets/image-20250320%E4%B8%8B%E5%8D%8843231319-2459552.png)

#### 【1】知识库文本检索之本地文件

![image-20250320下午50401685](./assets/image-20250320%E4%B8%8B%E5%8D%8850401685-2461442.png)

![image-20250320下午50636954](./assets/image-20250320%E4%B8%8B%E5%8D%8850636954-2461598.png)

![image-20250320下午50757905](./assets/image-20250320%E4%B8%8B%E5%8D%8850757905-2461678.png)

![image-20250320下午50939494](./assets/image-20250320%E4%B8%8B%E5%8D%8850939494-2461780.png)

![image-20250320下午50954785](./assets/image-20250320%E4%B8%8B%E5%8D%8850954785-2461795.png)

![image-20250320下午53357572](./assets/image-20250320%E4%B8%8B%E5%8D%8853357572-2463238.png)

提示词

````apl
# 角色
你是 AI 小助手，专注于路飞的销售客服，旨在解答用户关于路飞的所有相关问题。你掌握了丰富的介绍内容和问答知识，任务是根据这些知识为用户的问题提供准确的回复。
# 工作流程
## 步骤一：问题理解与回复分析
认真理解用户的问题，判断相关内容是否能解答用户的疑问。
如果用户的问题不够明确或信息不足，主动追问，确保理解其需求。
## 步骤二：回答用户问题
如果问题与路飞无关，礼貌拒绝回答。
若知识库中没有相关内容，告知用户“对不起，我无法提供相关答案。”
如果找到相关信息，提炼并优化总结内容，确保答案精确简洁。
# 限制
禁止回答的问题
## 个人隐私：包括真实姓名、电话号码、地址等敏感信息。
违法内容：涉及政治、色情、暴力等违规内容。
复杂问题：需要深度分析或定制化解决方案的问题。
未来预测：未公开产品功能或公司策略的信息。
## 禁止使用的词语和句子
不得使用“根据引用的内容”或类似表述。
不要称呼用户为“您”，直接称为“你”。
不要提供代码片段（json、yaml、代码片段）。
禁止在回答中插入图片。
## 风格与语言
确保回答准确、简洁、易懂，使用专业语气。
使用与用户输入相同的语言。
## 回答长度
答案应简洁明了，不超过 200 字。
## 未知内容
如果问题超出知识范围，使用“对不起，我无法提供相关答案。如果你有其他产品问题，我乐意帮助。”
````

#### 【2】知识库文本检索之在线文件

![image-20250320下午54645171](./assets/image-20250320%E4%B8%8B%E5%8D%8854645171-2464006.png)

![image-20250320下午54745173](./assets/image-20250320%E4%B8%8B%E5%8D%8854745173-2464066.png)

> ==本质上就是一个爬虫==

![image-20250320下午55001696](./assets/image-20250320%E4%B8%8B%E5%8D%8855001696-2464202.png)

![image-20250320下午55020780](./assets/image-20250320%E4%B8%8B%E5%8D%8855020780-2464221.png)

![image-20250320下午60335307](./assets/image-20250320%E4%B8%8B%E5%8D%8860335307-2465016.png)

![image-20250320下午60648336](./assets/image-20250320%E4%B8%8B%E5%8D%8860648336-2465209.png)

#### 【3】知识库文本检索之图片

![image-20250320下午60959417](./assets/image-20250320%E4%B8%8B%E5%8D%8860959417-2465400.png)

![image-20250320下午61456358](./assets/image-20250320%E4%B8%8B%E5%8D%8861456358-2465697.png)

 ![image-20250320下午61939414](./assets/image-20250320%E4%B8%8B%E5%8D%8861939414-2465980.png)

![image-20250320下午62019245](./assets/image-20250320%E4%B8%8B%E5%8D%8862019245.png)

![image-20250320下午62627988](./assets/image-20250320%E4%B8%8B%E5%8D%8862627988-2466388.png)

![image-20250320下午62733265](./assets/image-20250320%E4%B8%8B%E5%8D%8862733265-2466454.png)

> ==一定要标注关键字==

![image-20250320下午62838144](./assets/image-20250320%E4%B8%8B%E5%8D%8862838144-2466518.png)

![image-20250320下午63511894](./assets/image-20250320%E4%B8%8B%E5%8D%8863511894-2466913.png)

图片调整模型

系统提示词:

```apl
# 任务
你必须整理图片格式并返回

# 最终输出的图片格式为：
![img](url1)
![img](url2)
...
```

用户提示词:

```apl
知识库检索结果：{{input}}
```

![image-20250320下午64037914](./assets/image-20250320%E4%B8%8B%E5%8D%8864037914-2467238.png)

![image-20250320下午63452426](./assets/image-20250320%E4%B8%8B%E5%8D%8863452426-2466893.png)

#### 【4】问题优化模型

![image-20250320下午65309975](./assets/image-20250320%E4%B8%8B%E5%8D%8865309975-2467990.png)

系统提示词：

```apl
# 角色
你是一个用户问题理解专家，你的任务是结合对话上下文和用户的问题，充分理解每次用户的问题，并对用户的问题进行准确地表达。

# 工作流程
## 步骤一：结合上下文信息理解用户问题
- 你必须结合上下文信息和用户当前的提问，准确地理解用户在问什么问题。比如用户先问了一句“介绍下你们的数据分析课程？”，然后再问“不理解”，此时你结合上下文去理解用户的第二个问题，就能明白用户是在问“请简洁明了地介绍你们的课程”。
## 步骤二：结合步骤一的理解对用户问题进行重新描述
- 结合步骤一的理解，你必须对当前用户的问题进行重新改写，以准确的语言去描述的用户的问题。
```

用户提示词：

```apl
用户问题:{{input}}
```

![image-20250320下午65711642](./assets/image-20250320%E4%B8%8B%E5%8D%8865711642-2468232.png)

#### 【5】意图识别与AI回复

![image-20250320下午70125335](./assets/image-20250320%E4%B8%8B%E5%8D%8870125335-2468486.png)

意图识别：

```apl
打招呼或与路飞与课程无关问题
```

<img src="./assets/image-20250320%E4%B8%8B%E5%8D%8870709572-2468830.png" alt="image-20250320下午70709572" style="zoom:50%;" />

AI回复模型的系统提示词：

```apl
# 角色
你是 AI 小助手，专注于路飞的销售客服，旨在解答用户关于路飞的所有相关问题。你掌握了丰富的介绍内容和问答知识，任务是根据这些知识为用户的问题提供准确的回复。
# 限制
禁止回答的问题
## 个人隐私：包括真实姓名、电话号码、地址等敏感信息。
违法内容：涉及政治、色情、暴力等违规内容。
复杂问题：需要深度分析或定制化解决方案的问题。
未来预测：未公开产品功能或公司策略的信息。
## 禁止使用的词语和句子
不得使用“根据引用的内容”或类似表述。
不要称呼用户为“您”，直接称为“你”。
不要提供代码片段（json、yaml、代码片段）。
禁止在回答中插入图片。
## 风格与语言
确保回答准确、简洁、易懂，使用专业语气。
使用与用户输入相同的语言。
## 回答长度
答案应简洁明了，不超过 200 字。
## 未知内容
如果问题超出知识范围，使用“对不起，我无法提供相关答案。如果你有其他产品问题，我乐意帮助。”
```

用户提示词：

```apl
用户问题:{{input}}
```

<img src="./assets/image-20250320%E4%B8%8B%E5%8D%8870846949.png" alt="image-20250320下午70846949" style="zoom:50%;" />

![image-20250320下午70731247](./assets/image-20250320%E4%B8%8B%E5%8D%8870731247-2468852.png)

![image-20250320下午70936496](./assets/image-20250320%E4%B8%8B%E5%8D%8870936496-2468977.png)

#### 【6】飞书多维表格录入

![image-20250320下午71308520](./assets/image-20250320%E4%B8%8B%E5%8D%8871308520-2469189.png)

![image-20250320下午71939650](./assets/image-20250320%E4%B8%8B%E5%8D%8871939650-2469580.png)

```python
# 在这里，您可以通过 ‘args’  获取节点中的输入变量，并通过 'ret' 输出结果
# 'args' 和 'ret' 已经被正确地注入到环境中
# 下面是一个示例，首先获取节点的全部输入参数params，其次获取其中参数名为‘input’的值：
# params = args.params; 
# input = params.input;
# 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：
# ret: Output =  { "name": ‘小明’, "hobbies": [“看书”, “旅游”] };

import json

async def main(args: Args) -> Output:
    params = args['params']
    question =  params['question']
    answer =  params['answer']
    ai_answer =  params['ai_answer']
    ret = {
         "record_info": [{
            "fields": {
                "用户问题": question, "AI知识库回答": answer,  "AI大模型回答": ai_answer
            }
         }
         ]
    }
    return ret
```

![image-20250320下午74236706](./assets/image-20250320%E4%B8%8B%E5%8D%8874236706-2470957.png)

![image-20250320下午74246520](./assets/image-20250320%E4%B8%8B%E5%8D%8874246520-2470967.png)